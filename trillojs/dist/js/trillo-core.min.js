/*!
 * TrilloJS v0.5.0 (https://github.com/trillo/trillojs#readme)
 * Copyright 2017 Collager Inc.
 * Licensed under the MIT license
 */
!function(){"use strict";jQuery.fn.extend({dataOrAttr:function(a){return this.data(a)||this.attr(a)}})}();var Trillo={appLocation:"",OBJ_LOCKED:3,TrilloApp:{},appNamespace:null,isTouchSurface:!1};!function(){"use strict";Trillo.AppInitializer=function(){this.WIDTH_A=800,this.WIDTH_B=720,this.WIDTH_C=640,this.WIDTH_D=480,this.WIDTH_E=320};var a=Trillo.AppInitializer.prototype;a.initApp=function(a){this.cb=a,this.createAlertComponent(),this.createLogComponent(),this.createSearchHandler(),this.createBuilder(),this.createViewManager(),this.createModelFactory(),this.createApiAdapterFactory(),this.createObserverFactory(),this.createPage(),this.createRouter(),this.createTitleBarManager(),this.createContextMenuManager(),this.createPopoverMananger(),this.doCallback()},a.doCallback=function(){this.cb()},a.createAlertComponent=function(){Trillo.Alert&&(Trillo.alert=new Trillo.Alert)},a.createLogComponent=function(){Trillo.Log&&(Trillo.log=new Trillo.Log)},a.createSearchHandler=function(){Trillo.SearchHandler&&(Trillo.searchHandler=new Trillo.SearchHandler)},a.createViewManager=function(){Trillo.ViewManager&&(Trillo.viewManager=new Trillo.ViewManager)},a.createBuilder=function(){Trillo.Builder&&(Trillo.builder=new Trillo.Builder)},a.createModelFactory=function(){Trillo.ModelFactory&&(Trillo.modelFactory=new Trillo.ModelFactory)},a.createApiAdapterFactory=function(){Trillo.ApiAdapterFactory&&(Trillo.apiAdapterFactory=new Trillo.ApiAdapterFactory)},a.createObserverFactory=function(){Trillo.ObserverFactory&&(Trillo.observerFactory=new Trillo.ObserverFactory)},a.createPage=function(){Trillo.Page&&(Trillo.page=new Trillo.Page)},a.createRouter=function(){Trillo.Router&&(Trillo.router=new Trillo.Router)},a.createTitleBarManager=function(){Trillo.TitleBarManager&&(Trillo.titleBarManager=new Trillo.TitleBarManager)},a.createContextMenuManager=function(){Trillo.ContextMenuManager&&(Trillo.contextMenuManager=new Trillo.ContextMenuManager)},a.createPopoverMananger=function(){Trillo.PopoverManager&&(Trillo.popoverManager=new Trillo.PopoverManager)},Trillo.Options={V_MARGIN_TOP_ROW:10,V_MARGIN:20,H_MARGIN:20,BOTTOM_SPACE_FOR_INF_SCROLL:60,OPEN_ALL:"openAll",CLOSE_ALL:"closeAll",SCROLL_ON_HOVER:"scrollOnHover",AUTO_SCROLL:"autoScroll",SMOOTH_SCROLL:"smoothScroll",NO_SCROLL:"noScroll",NON_NATIVE_SCROLLBAR:"nonNativeScrollBar",DIALOG_MAX_WIDTH:"400px"},Trillo.Config={viewFileExtension:"",viewPath:null,basePath:null,pagePath:null},Trillo.HtmlTemplates={titleBarTitlePrefix:'<li nm="{{viewName}}-title-prefix">{{titlePrefix}}</li>',titleBarTitle:'<li nm="{{viewName}}-title">{{title}}</li>',titleBarTitlePrefix2:'<span nm="{{viewName}}-title-prefix">{{titlePrefix}}</span>',titleBarTitle2:'<span nm="{{viewName}}-title">{{title}}</span>',dropdownListItem:'<li><a class="js-list-item" nm="{{uid}}" href="#">{{name}}</a></li>'},Trillo.inherits=function(a,b){return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b}}(),Trillo.CSS={alertDanger:"alert-danger",alertSuccess:"alert-success",pointed:"trillo-pointed fa fa-hand-o-right",hasErrorCss:"trillo-has-error",hasMessageCss:"trillo-has-message",positionOutside:"trillo-position-outside",selected:"trillo-selected",appRready:"trillo-app-ready",tabActive:"active",treeItemTn:"trillo-tree-item-tn",tnLabel:"trillo-tn-label",treeNode:"tree-node",treeNodeLevelPrefix:"lvl",treeItem:"trillo-tree-item",itemClose:"trillo-item-close",itemOpen:"trillo-item-open",containerPreviewMode:"trillo-container-preview-mode",containerMark:"trillo-container-mark",buttonGroup:"btn-group",dropdown:"dropdown",buttonGroupOpen:"open",dropdownOpen:"open",fieldMsg:"trillo-field-msg"},function(){"use strict";Trillo.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},Trillo.isArray=function(a){return $.isArray(a)},Trillo.isObject=function(a){return $.isPlainObject(a)},Trillo.getAllClasses=function(a,b){var c=a.attr("class");return c?b&&(c=c.replace(b,"")):c="",c},Trillo.getRefByQualifiedName=function(a){for(var b=a.split("."),c=b.length,d=0,e=window;e&&c>d;)e=e[b[d++]];return e},Trillo.KeyValue=function(){this.l=[]};var a=Trillo.KeyValue.prototype;a.add=function(a,b){this.l.push({k:a,v:b})},a.getValue=function(a){for(var b=this.l,c=0;c<b.length;c++)if(b[c].k===a)return b[c].v;return null},Trillo.uid=function(a){var b,c=a._uid_;return c?c:(c=a._id_,c?(b=a._class_,b?b+"."+c:c):a.uid?a.uid:a.name)},Trillo.uidToClass=function(a){var b,c=null;return a&&(b=a.indexOf("."),b>0&&(c=a.substring(0,b))),c},Trillo.uidToId=function(a){var b,c=null;return a&&(b=a.indexOf("."),b>0&&(c=a.substring(b+1))),c},Trillo.isUid=function(a){if(a){var b=a.indexOf(".");return b>0}return!1},Trillo.offsetByFixedAbsolute=function(a){var b,c=0;a.prevAll().each(function(){b=$(this).css("position"),("fixed"===b||"absolute"===b)&&(c+=$(this).outerHeight())}),a.css("margin-top",c)},Trillo.showBusy=function(){$(".js-busy-indicator").show().css("visibility","visible")},Trillo.hideBusy=function(){$(".js-busy-indicator").css("visibility","hidden")},Trillo.elemId=0,Trillo.getUniqueElemId=function(){return this.elemId++,"_trillo_e_"+this.elemId},Trillo.getObjectValue=function(a,b){if(b&&0!==b.length)for(var c=b.split("."),d=0;d<c.length&&(a=a[c[d]],a);d++);return void 0===a||null===a?null:a},Trillo.setObjectValue=function(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)e=a[d[f]],e||(e={},a[d[f]]=e),a=e;b=d[d.length-1],a[b]=c},Trillo.mergeObject=function(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)""!==d[f]&&(e=a[d[f]],e||(e={},a[d[f]]=e),a=e);b=d[d.length-1],""===b?$.extend(a,c):a[b]=c},Trillo.formatValue=function(a,b,c){if(!b||""===b)return c?"":"&nbsp;";var d=a.dataOrAttr("display-type"),e=a.dataOrAttr("enum-name");if(d){if("date"===d||"time"===d||"datetime"===d)return this.formatDate(a,b);if(e)return this.getEnumName(a,b)}return b},Trillo.formatDate=function(a,b){var c=a.dataOrAttr("format")||"M/D/YY hh:mm:ss A";return moment(b).format(c)},Trillo.getEnumName=function(a,b){var c=a.dataOrAttr("enum-name");return Trillo.enumCatalog.getName(c,b)},Trillo.setCookieValue=function(a,b,c){var d,e;if(c){var f=new Date;f.setTime(f.getTime()+24*c*60*60*1e3),d="; expires="+f.toGMTString()}else d="";e=b+d+"; path=/";var g=this.getCookieDomain();g&&(e+=";domain="+g),document.cookie=a+"="+e},Trillo.getCookieValue=function(a){a+="=";var b=document.cookie.indexOf(a);if(b>=0){var c=document.cookie.substring(b+a.length);return b=c.indexOf(";"),0>b&&(b=c.length),c=c.substring(0,b),unescape(c)}return""},Trillo.deleteCookie=function(a){""!==Trillo.getCookieValue(a)&&(document.cookie=a+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT")},Trillo.getCookieDomain=function(){var a=document.domain;if(!a||""===a)return null;var b=null,c=a.lastIndexOf(".");if(c>0){var d=a.substring(0,c),e=a.substring(c);c=d.lastIndexOf("."),c>=0?(d=d.substring(c),b=d+e):b="."+d+e}return b},Trillo.matches=function(a,b,c){var d;for(d in a)if("undefined"==typeof b[d]&&"undefined"!=typeof a[d])return!1;for(d in a)if(a[d])switch(typeof a[d]){case"object":if(c){if(!Trillo.matches(a[d],b[d]))return!1}else if(a[d]!==b[d])return!1;break;case"function":break;default:if(a[d]!==b[d])return!1}else if(b[d])return!1;for(d in b)if("undefined"==typeof a[d])return!1;return!0},Trillo.replacer=function(a,b){return 0===a.indexOf("_trillo_")?void 0:b},Trillo.stringify=function(a){return JSON.stringify(a,Trillo.replacer)},Trillo.getSpecObject=function(a,b){function c(a){var b=a.html(),c=null;if(b&&b.length)try{c=$.parseJSON(b)}catch(d){Trillo.log.error("Failed to parse view spec JSON: "+d.message+"<br/>"+b)}return c}function d(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null}var e=a.find(b);if(0===e.length)return null;var f=e.length>0?$(e[0]):e,g=c(f);if(g&&e.length>1)for(var h=1;h<e.length;h++){var i=c($(e[h]));if(null!==i){i.embedded=!0,g.nextViewSpecs||(g.nextViewSpecs=[]);var j=d(g.nextViewSpecs,i.name);j?$.extend(j,i):g.nextViewSpecs.push(i)}}return e.remove(),g},Trillo.getNearestInDOMTree=function(a,b){for(var c=a.find(b);0===c.length&&a.length&&"html"!==(a.prop("nodeName")||"").toLowerCase();)a=a.parent(),c=a.find(b);return c},Trillo.getTriggerFromPath=function(a){var b=a.indexOf(":");return b>=0?a.substring(0,b):a},Trillo.getViewNameFromPath=function(a){var b=a.indexOf(":");return b>=0?a.substring(b+1):a},Trillo.clearObj=function(a){var b;for(b in a)delete a[b]},Trillo.endsWith=function(a,b){return a.length<b.length?!1:a.lastIndexOf(b)===a.length-b.length},Trillo.deleteFromArray=function(a,b){var c=a.indexOf(b);c>=0&&a.splice(c,1)},Trillo.findByProp=function(a,b,c){if(a)for(var d=0;d<a.length;d++)if(a[d][b]===c)return a[d];return null},Trillo.endsWith=function(a,b){return a&&b?-1!==a.indexOf(b,a.length-b.length):!1},Trillo.endsWithIgnoreCase=function(a,b){return a&&b?(a=a.toLowerCase(),b=b.toLowerCase(),-1!==a.indexOf(b,a.length-b.length)):!1},Trillo.setCSRFCookieHeader=function(a,b){function c(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e16]+1e16).replace(/[01]/g,c)}var d="X-CSRF-TOKEN",e="CSRF-TOKEN",f=$("meta[name='_csrf']").attr("content"),g=$("meta[name='_csrf_header']").attr("content");g&&f?a.setRequestHeader(g,f):(f=Trillo.getCookieValue(e),(b||!f)&&(f=c(),Trillo.setCookieValue(e,f)),a.setRequestHeader(d,f))}}(),function(){"use strict";Trillo.Storage=function(a){this.storage=a};var a=Trillo.Storage.prototype;a.setItem=function(a,b){b="string"==typeof b?b:JSON.stringify(b),this.storage.setItem(a,b)},a.getItem=function(a){return this.storage.getItem(a)},a.getItemAsObj=function(a){var b=this.storage.getItem(a);return b?JSON.parse(b):b},a.removeItem=function(a){this.storage.removeItem(a)},a.clear=function(){var a,b=[];for(a=0;a<this.storage.length;a++)b.push(this.storage.key(a));for(a=0;a<b.length;a++)this.removeItem(b[a])},a.removeAllStartingWith=function(a){var b,c=[];for(b=0;b<this.storage.length;b++)0===this.storage.key(b).indexOf(a)&&c.push(this.storage.key(b));for(b=0;b<c.length;b++)this.removeItem(c[b])},Trillo.sessionStorage=new Trillo.Storage(sessionStorage),Trillo.localStorage=new Trillo.Storage(localStorage)}(),function(){"use strict";Trillo.NavHistory=function(){};var a=Trillo.NavHistory.prototype;a.add=function(a,b,c){console.log("NavHistory.add(): "+a+" -> "+b),Trillo.localStorage.setItem(a,b),c?Trillo.localStorage.setItem("params://"+Trillo.getFullPath(a,b),c):Trillo.localStorage.removeItem("params://"+Trillo.getFullPath(a,b))},a.get=function(a){if(this.isDisabled())return null;var b=Trillo.localStorage.getItem(a);return console.log("NavHistory.get(): "+a+" -> "+b),b},a.remove=function(a){return this.isDisabled()?null:(console.log("NavHistory.remove(): "+a),void Trillo.localStorage.removeItem(a))},a.getParams=function(a,b,c){if(this.isDisabled())return null;var d=Trillo.localStorage.getItem("params://"+Trillo.getFullPath(a,b));return console.log("NavHistory.getParams(): "+a+"/"+b+"?"+d),d},a.setDisabled=function(a){Trillo.sessionStorage.setItem("_nav_history_disabled",""+a)},a.isDisabled=function(){return"true"===Trillo.sessionStorage.getItem("_nav_history_disabled")}}(),Trillo.navHistory=new Trillo.NavHistory,function(){"use strict";Trillo.EnumCatalog=function(){this.table={}};var a=Trillo.EnumCatalog.prototype;a.register=function(a,b){this.table[a]=b},a.getEnum=function(a){return this.table[a]},a.getName=function(a,b){if(!a)return b;var c=this.table[a];if(!c)return b;for(var d=0;d<c.length;d++)if(c[d].v===b)return c[d].n;return b},a.getValue=function(a,b){var c=this.table[a];if(!c)return null;for(var d=0;d<c.length;d++)if(c[d].n===b)return c[d].v;return null},a.registerAll=function(a){var b=this;$.each(a,function(a,c){b.register(a,c)})}}(),Trillo.enumCatalog=new Trillo.EnumCatalog,$(function(){var a=0;Trillo.deleteCookie("CSRF-TOKEN"),$.ajaxSetup({cache:!1,beforeSend:function(b){Trillo.orgName&&b.setRequestHeader("x-org-name",Trillo.orgName),Trillo.appName&&b.setRequestHeader("x-app-name",Trillo.appName),Trillo.setCSRFCookieHeader(b,0===a),a++},complete:function(b,c){a>0&&a--}}),$(document).ajaxStart(function(){Trillo.alert.clear(),Trillo.showBusy()}).ajaxSend(function(a,b,c){}).ajaxError(function(a,b,c){try{var d=$.parseJSON(b.responseText);if(d.redirectUrl)return void("/_login"===d.redirectUrl?window.location.reload(!0):window.location.href=d.redirectUrl);if(c.error)return;var e=d.message||d.detail;e&&("_REPO_NOT_AUTORIZED"==e?(e="You are viewing the application in demo mode.<br/>All update operations are disabled in this mode.",Trillo.showModal("Demo Mode",e)):"_NOT_AUTORIZED"==e?(e="Access is not allowed. <br/>Either your session has expired <br/>oryou are accessing a page not available using current login info.",Trillo.log.error(e)):Trillo.log.error(e))}catch(f){if(c.error)return;Trillo.log.error(f.message)}}).ajaxSuccess(function(a,b,c){}).ajaxComplete(function(a,b,c){}).ajaxStop(function(){Trillo.hideBusy()})}),function(){"use strict";Trillo.Log=function(){};var a=Trillo.Log.prototype;a.error=function(a){Trillo.alert.showError("Error",a)},a.warning=function(a){Trillo.alert.showError("Warning",a)},a.info=function(a){Trillo.alert.show("Info",a)}}(),function(){"use strict";Trillo.Alert=function(){this.$e=$(".js-alert"),this.$t=this.$e.find(".js-title"),this.$m=this.$e.find(".js-message"),this.fo=$.proxy(this.fadeOut,this),this.actionM=$.proxy(this.doAction,this),this.initActionHandler()};var a=Trillo.Alert.prototype;a.initActionHandler=function(){this.$e.find('[nm="close"]').off("click",this.actionM).on("click",this.actionM)},a.show=function(a,b,c,d){this.$e.removeClass(Trillo.CSS.alertDanger).addClass(Trillo.CSS.alertSuccess),this._show(a,b,c,d)},a.showError=function(a,b,c,d){this.$e.removeClass(Trillo.CSS.alertSuccess).addClass(Trillo.CSS.alertDanger),this._show(a,b,c,d)},a._show=function(a,b,c,d){this.$e.finish(),d?this.$e.css("left",d.offset().left+Math.floor(d.width()/2)):this.$e.css("left",0),this.$t.html(a),b=b.replace(/(?:\r\n|\r|\n)/g,"<br />"),this.$m.html(b),this.$e.hide(),this.$e.fadeIn(1e3,c?this.fo:null)},a.fadeOut=function(a){this.$e.fadeOut(8e3)},a.doAction=function(a){if(a){a.stopPropagation();var b=$(a.target).dataOrAttr("nm");"close"===b&&this.clear()}},a.clear=function(a){this.$e.finish(),this.$e.hide()},a.notYetImplemented=function(a){this.showError("Not Implemented","Action '"+a+"' is not yet implemented",!0)}}(),function(){"use strict";Trillo.Modal=function(a){var b=this.$e=$(".js-modal");this.$t=b.find('[nm="modalTitle"]'),this.$m=b.find('[nm="modalMessage"]'),this.$close=b.find('[nm="modalClose"]'),this.$ok=b.find('[nm="modalOK"]'),this.$no=b.find('[nm="modalNo"]'),this.$yes=b.find('[nm="modalYes"]'),b.find("button").on("click",$.proxy(this.doAction,this))};var a=Trillo.Modal.prototype;a.doAction=function(a){var b=$(a.target),c=b.dataOrAttr("nm"),d=this.options;switch(c){case"modalOK":this.hide(),d.ok&&d.ok(d)}},a.show=function(a,b,c){c=c||{},this.options=c,this.$t.html(a),this.$m.html(b),c.ok?this.$ok.show():this.$ok.hide(),c.yes?this.$yes.show():this.$yes.hide(),c.no?this.$no.show():this.$no.hide(),this.$e.modal("show")},a.hide=function(){this.$e.modal("hide")},Trillo.showModal=function(a,b,c){Trillo._modal||(Trillo._modal=new Trillo.Modal),Trillo._modal.show(a,b,c)},Trillo.hideModal=function(a,b,c){Trillo._modal&&Trillo._modal.hide()}}(),function(){"use strict";Trillo.Router=function(){this.handler=$.proxy(this.historyChanged,this),this.busyProcessing=!1,this.viewsMarkedForClearing=[],this.isHistoryOn=!1,this.initialRoute=null,this.defaultRoute=null};var a=Trillo.Router.prototype;a.start=function(){Trillo.navHistory.setDisabled(!0);var a=(location.pathname||"")+(location.search||"");this.initialRoute=a,this.routeTo(a)},a.setHistoryOn=function(){$.history.on("load change",this.handler).listen()},a.historyChanged=function(a,b,c){"load"===a.type&&Trillo.navHistory.setDisabled(!0),b&&!this.busyProcessing&&(b===this.initialRoute&&(b=this.defaultRoute),this.routeTo(b,!1,!0))},a.routeTo=function(a,b,c){if(!this.busyProcessing){this.busyProcessing=!0;var d=this;if(a=this.normalizeRoute(a),c){var e=Trillo.getRouteSpecsFromRoute(a),f=Trillo.getRouteUptoIndex(e,e.length-1,!1);f&&Trillo.navHistory.remove(f)}var g=Trillo.page.show(a);g.done(function(a){if(a&&a.length>0){var c=a[a.length-1].controller().getRouteUpTo(!0,!0);"true"===Trillo.appContext.autoLogin&&(c+="?autoLogin=true"),d.isHistoryOn?b&&$.history.push(c):d.defaultRoute!=c&&(d.defaultRoute=c,window.history.replaceState({},null,c))}d.clearMarkedForClearing(),d.isHistoryOn||(d.isHistoryOn=!0,d.setHistoryOn()),d.busyProcessing=!1,Trillo.navHistory.setDisabled(!1)}),g.fail(function(a){d.clearMarkedForClearing(),d.busyProcessing=!1})}},a.markForClearing=function(a){this.viewsMarkedForClearing.push(a)},a.clearMarkedForClearing=function(a){var b=this.viewsMarkedForClearing;if(b.length>0){for(var c=b.length-1;c>=0;c--)b[c].clear();b.length=0,Trillo.page.windowResized()}},a.showingView=function(a){for(var b=this.viewsMarkedForClearing,c=0;c<b.length;c++)if(a.viewSpec.container&&b[c].viewSpec.container===a.viewSpec.container)return b[c].clear(),void b.splice(c,1)},a.normalizeRoute=function(a){var b;if(!a)return a;a=decodeURIComponent(a);var c=Trillo.Config.pagePath;return 0===a.indexOf(c)&&(a=a.substring(c.length),0===a.indexOf(";")&&(b=a.indexOf("/"),b>0&&(a=a.substring(0,b)))),0===a.indexOf("/")&&(a=a.substring(1)),b=a.indexOf("?"),b>-1&&(a=a.substring(0,b)),a}}(),function(){"use strict";Trillo.ModelFactory=function(a){};var a=Trillo.ModelFactory.prototype;a.createModel=function(a,b){a=$.extend({},a);var c;if(c=this.createModelForName(a,b),!c){var d=Trillo.appNamespace;c=this.createModelForNS(d,a,b),c||(c=this.createModelForNS(window.Shared,a,b)),c||(a.impl&&debug.warn("Model class '"+a.impl+"' not found, using default Model."),c=new Trillo.Model(a,b))}return c},a.createModelForName=function(a,b){var c=a.impl;if(c){var d=Trillo.getRefByQualifiedName(c);if(d)return new d(a,b)}return null},a.createModelForNS=function(a,b,c){var d=b.impl;if(d){if(a&&a[d])return new a[d](b,c);var e=Trillo.getRefByQualifiedName(d);if(e)return new e(b,c)}return null}}(),function(){"use strict";Trillo.Model=function(a,b){this.modelSpec=a,this._controller=b,this.observer=null,this.table={},this.newItemsAtEnd=a.newItemsAtEnd,this.dataPath=a.dataPath||"",this.trackedData=a.trackedData,this.listners=[],this.addListener(b),this.saveChanges=[],this.revertedChanges=[],this.managingChange=!1,this.txOn=!1,this.txId=-1,this.txIdCounter=0,this.changeContext=null,this.state={},this.paginationInfo=null};var a=Trillo.Model.prototype;a.view=function(){return this._controller.view()},a.controller=function(){return this._controller},a.getParentData=function(){var a=this._controller.parentController();return a?a.getData():null},a.getSelectedObj=function(){return this._controller.getSelectedObj()},a.getParentSelectedObj=function(){var a=this._controller.parentController();return a?a.getSelectedObj():null},a.getClosestSelectedObj=function(){return this._controller.getClosestSelectedObj()},a.getState=function(){return this.state},a.getContextUid=function(){return this._controller.getContextUid()},a.setDataQuiet=function(a){a&&(this.data=a,this.setupModel())},a.appendDataQuiet=function(a){if(this.data&&Trillo.isArray(this.data)){if(Trillo.isArray(a)){for(var b=a.length,c=this.data,d=0;b>d;d++)c.push(a[d]);this.setupModel()}}else this.setDataQuiet(a)},a.setData=function(a){a!==this.data&&(a||(a={}),this.data=a,this.setupModel(),this.triggerModelDataChanged(),this.managingChange&&(this.saveChanges=[],this.revertedChanges=[],this.controller().changeManagerUpdated(this.saveChanges.length,this.revertedChanges.length)))},a.clear=function(){this.clearObserver(),this.data=null,this.table={}},a.cloneData=function(){var a=this.data;if(Trillo.isArray(a)){var b=[];return $.each(a,function(a,c){b.push($.extend({},c))}),b}return $.extend({},a)},a.getData=function(){return this.data},a.setValue=function(a,b){var c=null,d=this.getValue(a),e=this.getChangeManager();e&&(c=e.beginTx(),this.saveChange({changeType:"objectAttrChanged",obj:this.data,name:a,value:b,oldValue:d,affected:this.getAffectedData(this.data)})),Trillo.setObjectValue(this.data,a,b),this._controller.attrChanged(this.data,a,b,d,this),this.triggerChanged(this.data),c&&c()},a.setValueQuiet=function(a,b){Trillo.setObjectValue(this.data,a,b)},a.setValueNoRecording=function(a,b){var c=this.getValue(a);Trillo.setObjectValue(this.data,a,b),this._controller.attrChanged(this.data,a,b,c,this),this.triggerChanged(this.data)},a.getValue=function(a){return Trillo.getObjectValue(this.data,a)},a.setObjAttrByUid=function(a,b,c){var d=this.getObj(a);d&&this.setObjAttr(d,b,c)},a.setObjAttr=function(a,b,c){var d=null;if(a){var e=this.getChangeManager(),f=Trillo.getObjectValue(a,b);e&&(d=e.beginTx(),this.saveChange({changeType:"objectAttrChanged",obj:a,name:b,value:c,oldValue:f,affected:this.getAffectedData(this.data)})),Trillo.setObjectValue(a,b,c),this._controller.attrChanged(a,b,c,f,this),this.triggerChanged(a)}d&&d()},a.setObjAttrByUidQuiet=function(a,b,c){var d=this.getObj(a);d&&this.setObjAttrQuiet(d,b,c)},a.setObjAttrQuiet=function(a,b,c){a&&Trillo.setObjectValue(a,b,c)},a.setObjAttrByUidNoRecording=function(a,b,c){var d=this.getObj(a);d&&this.setObjAttrNoRecording(d,b,c)},a.setObjAttrNoRecording=function(a,b,c){if(a){var d=Trillo.getObjectValue(a,b);Trillo.setObjectValue(a,b,c),this._controller.attrChanged(a,b,c,d,this),this.triggerChanged(a)}},a.getObjAttrByUid=function(a,b){var c=this.getObj(a);return c?Trillo.getObjectValue(c,b):null},a.getObj=function(a){if(this.table[a])return this.table[a];if(this.data)if(Trillo.isArray(this.data)){for(var b=this.data,c=0;c<b.length;c++)if(b[c].uid===a)return b[c]}else if(this.data.uid===a)return this.data;return null},a._setObjAttr=function(a,b,c){Trillo.setObjectValue(a,b,c),this.triggerChanged(a)},a.addListener=function(a){this.hasListener(a)||this.listners.push(a)},a.removeListener=function(a){for(var b=this.listners,c=b.length,d=0;c>d;d++)if(b[d]===a)return this.listners.splice(d,1),!0;return!1},a.hasListener=function(a){for(var b=this.listners,c=b.length,d=0;c>d;d++)if(b[d]===a)return!0;return!1},a.triggerAdded=function(a){for(var b=this.listners,c=b.length,d=0;c>d;d++)b[d].objAdded&&b[d].objAdded(a,this.newItemsAtEnd)},a.triggerChanged=function(a){for(var b=this.listners,c=b.length,d=0;c>d;d++)b[d].objChanged&&b[d].objChanged(a)},a.triggerDeleted=function(a){for(var b=this.listners,c=b.length,d=0;c>d;d++)b[d].objDeleted&&b[d].objDeleted(a)},a.triggerModelDataChanged=function(){for(var a=this.listners,b=a.length,c=0;b>c;c++)a[c].modelDataChanged&&a[c].modelDataChanged(this)},a.addObj=function(a){this.table[a.uid]=a;var b=this.data;if(b&&"undefined"!=typeof b.length){this.newItemsAtEnd?b.push(a):b.unshift(a);var c=this.paginationInfo;c&&(c.totalNumberOfItems+=1,c.numberOfPages=Math.ceil(c.totalNumberOfItems/c.pageSize))}return this.triggerAdded(a),a},a.changeObj=function(a){var b,c=this.table;return b=c[a.uid],b&&(b!==a&&$.extend(b,a),this.triggerChanged(b)),b},a.deleteObj=function(a){var b,c=this.table;if(b=c[a.uid]){c[a.uid]=null;var d=this.data;if(d&&"undefined"!=typeof d.length){Trillo.deleteFromArray(d,a);var e=this.paginationInfo;e&&(e.totalNumberOfItems-=1,e.numberOfPages=Math.ceil(e.totalNumberOfItems/e.pageSize))}this.triggerDeleted(b)}return b},a.addTreeNodeObj=function(a,b){b.children||(b.children=[]),b.children.push(a),this.setupTreeData(),this.addObj(a)},a.deleteTreeNodeObj=function(a){var b=a.parent;b&&b.children&&Trillo.deleteFromArray(b.children,a),this.setupTreeData(),this.deleteObj(a)},a.createObserver=function(){if(this.modelSpec.observeChanges&&!this.observer&&this.listners.length>0){var a=this.getObserverOptions();null!==a&&(a.cb=$.proxy(this.receivedNotifications,this),this.observer=Trillo.observerFactory.createObserver(a))}},a.getObserverOptions=function(){var a=this._controller.apiAdapter();return a?a.getObserverOptions(this.data):null},a.clearObserver=function(){this.observer&&(this.observer.clear(),this.observer=null),this.table={}},a.receivedNotifications=function(a){var b,c=this.table;b=c[a.uid],a._deleted_?this.deleteObj(a):b?this.changeObj(a):this.addObj(a)},a.doSort=function(a,b){function c(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}debug.debug("Sort by: "+a);var d=this.data.items||this.data;Trillo.isArray(d)&&("asc"===b?d.sort(function(a,b){return c(a,b)}):d.reverse(function(a,b){return c(a,b)}))},a.getChangeManager=function(){if(this.managingChange)return this;var a=this._controller.parentController();return a?a.model().getChangeManager():null},a.recrodDataChange=function(a,b){var c=this.getChangeManager();if(c){var d=c.beginTx();c._saveChange({changeType:"modelData",oldData:a,newData:this.cloneData(),data:this.data,params:b,affected:this.getAffectedData(this.data)},this),d()}},a.saveChange=function(a){var b=this.getChangeManager();if(b){var c=b.beginTx();b._saveChange(a,this),c()}},a._saveChange=function(a,b){this.revertedChanges=[],this.saveChanges.push({change:a,sourceModel:b,__txId:this.txId,changeContext:b.changeContext}),this.controller().changeManagerUpdated(this.saveChanges.length,this.revertedChanges.length)},a.undo=function(){if(this.saveChanges.length){for(var a=this.saveChanges.length-1,b=this.saveChanges[a].__txId,c=!0;a>=0&&this.saveChanges[a].__txId===b;){var d=this.saveChanges.pop();this.controller().undoing(d.change,c,d.changeContext),d.sourceModel.undoChange(d.change),this.revertedChanges.push(d),this.controller().undone(d.change,c,d.changeContext),a--,c=!1}this.controller().changeManagerUpdated(this.saveChanges.length,this.revertedChanges.length),this.controller().undoCompleted()}},a.redo=function(){if(this.revertedChanges.length){for(var a=this.revertedChanges.length-1,b=this.revertedChanges[a].__txId,c=!0;a>=0&&this.revertedChanges[a].__txId===b;){var d=this.revertedChanges.pop();this.controller().redoing(d.change,c,d.changeContext),d.sourceModel.redoChange(d.change),this.saveChanges.push(d),this.controller().redone(d.change,c,d.changeContext),a--,c=!1}this.controller().changeManagerUpdated(this.saveChanges.length,this.revertedChanges.length),this.controller().redoCompleted()}},a.undoChange=function(a){var b=a.changeType;"objectAttrChanged"===b?this._setObjAttr(a.obj,a.name,a.oldValue):"modelData"===b&&this.data===a.data&&this._copyData(a.oldData)},a.redoChange=function(a){var b=a.changeType;"objectAttrChanged"===b?this._setObjAttr(a.obj,a.name,a.value):"modelData"===b&&this.data===a.data&&this._copyData(a.newData)},a.beginTx=function(){if(this.txOn)return function(){};this.txIdCounter+=1,this.txId=this.txIdCounter,this.txOn=!0,this.controller().txStarted();var a=this;return function(){a.controller().txEnding(),setTimeout(function(){a.txId=-1,a.txOn=!1,a.controller().txEnded()},0)}},a.isSaveNeeded=function(){return this.saveChanges.length>0},a._copyData=function(a){var b=this.data;if(Trillo.isArray(b)){var c,d=b.slice();b.length=0;var e;for(e=0;e<a.length;e++)d.length>e?(c=d[e],Trillo.clearObj(c)):c={},b.push($.extend(d.length>e?d[e]:{},a[e]))}else Trillo.clearObj(b),$.extend(b,a);this.triggerModelDataChanged()},a.getAffectedData=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c]);return this.trackedData&&b.push(this.trackedData),b},a.isAffected=function(a){var b,c,d,e,f=this.saveChanges,g=f.length;for(b=0;g>b;b++)if(e=f[b].change,d=e.affected)for(c=0;c<d.length;c++)if(d[c]==a)return!0;return!1},a.setChangeContext=function(a){this.changeContext=a},a.setTrackedData=function(a){this.trackedData=a},a.getChangeContext=function(){return this.changeContext},a.setupModel=function(){this.table={},this.data&&(this._initData(this.data,null),this.__treeSetup=!0,this.createObserver())},a._initData=function(a,b){Trillo.isObject(a)?this._initObj(a,b):Trillo.isArray(a)&&this._initArray(a,b)},a._initObj=function(a,b){var c=Trillo.uid(a);c&&(a._uid_||(a._uid_=c),a.uid||(a.uid=c),a._parentUid_=b?b._uid_:null,this.table[c]=a);for(var d in a)this._initData(a[d],a)},a._initArray=function(a,b){var c,d=a.length;for(c=0;d>c;c++)this._initData(a[c],b)},a.setupTreeData=function(){this.data&&(this._initData(this.data,null),this.__treeSetup=!0)},a.getDataReferences=function(){var a={state:this.state},b=this.data;return b&&(a.data=b),b=this.getSelectedObj(),b&&(a.selectedObj=b),b=this.getParentData(),b&&(a.parentData=b),b=this.getParentSelectedObj(),b&&(a.parentSelectedObj=b),b=this.getClosestSelectedObj(),b&&(a.closestSelectedObj=b),b=this.getContextUid(),b&&(a.contextUid=b),b=this._controller.getParams(),b&&(a.params=b),a},a.getPaginationInfo=function(){return this.paginationInfo},a.setPaginationInfo=function(a){this.paginationInfo=a},a.getParent=function(a){var b=function(b){return b&&a._parentUid_==b._uid_?b:void 0};return this._traverseTree(this.data,b)},a._traverseTree=function(a,b){return Trillo.isObject(a)?this._traverseObj(a,b):Trillo.isArray(a)?this._traverseArray(a,b):null},a._traverseObj=function(a,b){var c=b(a);if(c)return c;for(var d in a)if("parent"!=d&&a.hasOwnProperty(d)&&(c=this._traverseTree(a[d],b)))return c;return null},a._traverseArray=function(a,b){var c,d,e=a.length;for(c=0;e>c;c++)if(d=this._traverseTree(a[c],b))return d;return null}}(),function(){"use strict";Trillo.ObserverFactory=function(a){this.observerClass=Trillo.Observer};var a=Trillo.ObserverFactory.prototype;a.createObserver=function(a){return new this.observerClass(a)},Trillo.BaseObserver=function(a){this.options=a};var b=Trillo.BaseObserver.prototype;b.clear=function(){},b.receivedNotifications=function(a){this.options.cb(a)},Trillo.Observer=Trillo.inherits(Trillo.BaseObserver,function(a){Trillo.BaseObserver.call(this,a),this.start()});var c=Trillo.Observer.prototype;c.start=function(){if(Trillo.appContext.webSocketEndPoint&&Trillo.appContext.webSocketDestination){var a=this;if(!a.subscribed){var b=this.options;$.ajax({url:"/_subscribe?"+(b.uid?"uid="+b.uid:"cls="+b.cls),type:"get"}).done(function(){a.subscribed=!0,!Trillo.webSocket&&Trillo.WebSocket&&Trillo.appContext.loggedIn&&(Trillo.webSocket=new Trillo.WebSocket),Trillo.webSocket.addObserver(a)})}}},c.clear=function(){var a=this;if(Trillo.webSocket&&Trillo.webSocket.removeObserver(a),a.subscribed){a.subscribed=!1;var b=this.options;$.ajax({url:"/_unsubscribe?"+(b.uid?"uid="+b.uid:"cls="+b.cls),type:"get"}).done(function(){})}},Trillo.WebSocket=function(a){if(this.observers=[],"undefined"!=typeof SockJS&&"undefined"!=typeof Stomp&&Trillo.appContext.webSocketEndPoint&&Trillo.appContext.webSocketDestination)try{var b=new SockJS(Trillo.appContext.webSocketEndPoint);this.stompClient=Stomp.over(b),this.stompClient.debug=null,this.connect()}catch(c){}};var d=Trillo.WebSocket.prototype;d.connect=function(){if(this.stompClient){var a=this;this.stompClient.connect({},function(b){a.stompClient.subscribe(Trillo.appContext.webSocketDestination,$.proxy(a.received,a))})}},d.disconnect=function(){this.stompClient&&this.stompClient.disconnect()},d.received=function(a){var b=JSON.parse(a.body),c=this.observers,d=c.length,e=b.uid;if(e){var f=e.indexOf("."),g="";f>0&&(g=e.substring(0,f));for(var h=0;d>h;h++)(c[h].options.cls===g||c[h].options.uid===e)&&c[h].receivedNotifications(b)}},d.ping=function(){if(this.stompClient){var a={};a.className="test",this.stompClient.send("/_app/pingWS",{},Trillo.stringify(a))}},d.addObserver=function(a){this.hasObserver(a)||this.observers.push(a)},d.removeObserver=function(a){for(var b=this.observers,c=b.length,d=0;c>d;d++)if(b[d]===a)return this.observers.splice(d,1),!0;return!1},d.hasObserver=function(a){for(var b=this.observers,c=b.length,d=0;c>d;d++)if(b[d]===a)return!0;return!1}}(),function(){"use strict";Trillo.ApiAdapterFactory=function(a){};var a=Trillo.ApiAdapterFactory.prototype;a.createApiAdapter=function(a,b){a=$.extend({},a);var c;if(c=this.createApiAdapterForName(a,b),!c){var d=Trillo.appNamespace;c=this.createApiAdapterForNS(d,a,b),c||(c=this.createApiAdapterForNS(window.Shared,a,b))}return c},a.createApiAdapterForName=function(a,b){var c=a.impl;if(c){var d=Trillo.getRefByQualifiedName(c);if(d)return new d(a,b);
}return null},a.createApiAdapterForNS=function(a,b,c){var d=b.impl;if(d){if(a&&a[d])return new a[d](b,c);var e=Trillo.getRefByQualifiedName(d);if(e)return new e(b,c)}return null}}(),function(){"use strict";Trillo.ApiAdapter=function(a,b){this.apiSpec=a,this._controller=b};var a=Trillo.ApiAdapter.prototype;a.controller=function(){return this._controller},a.model=function(){return this._controller?this._controller.model():null},a.isApiSpecChanged=function(a){return!1},a.loadData=function(a){var b=$.Deferred();return this.dataLoaded(b,null),b.promise()},a.dataLoaded=function(a,b){this.assignUid(b),a.resolve(b)},a.getObserverOptions=function(){return null},a.assignUid=function(a){}}(),function(){"use strict";Trillo.RestAdapter=Trillo.inherits(Trillo.ApiAdapter,function(a,b){Trillo.ApiAdapter.call(this,a,b),this.serviceUrl=a.serviceUrl,this.lastParams=null});var a=Trillo.RestAdapter.prototype;a.isApiSpecChanged=function(a){return this.lastUrl!==this.getFullUrl(this.lastParams)},a.loadData=function(a){var b=$.Deferred(),c=this.getFullUrl(a);return this.lastParams=a,this.lastUrl=c,$.ajax({url:c,type:"get"}).done($.proxy(this.dataLoaded,this,b)).fail(function(){b.reject({errorMsg:"Failed to load model"})}),b.promise()},a.getFullUrl=function(a){var b=this.model().getDataReferences();a&&(b.params=$.extend({},b.params,a));var c=this.serviceUrl;if(c&&c.indexOf("{{")>=0&&(c=Mustache.render(c,b)),this.apiSpec.query){var d=Mustache.render(this.apiSpec.query,b);c=c+(c.indexOf("?")>=0?"&":"?")+d}return c}}(),function(){"use strict";Trillo.TestDataAdapter=Trillo.inherits(Trillo.ApiAdapter,function(a,b){Trillo.ApiAdapter.call(this,a,b)});var a=Trillo.TestDataAdapter.prototype;a.loadData=function(){return this.loadTestData()},a.loadTestData=function(){var a=$.Deferred();return $.ajax({url:"/_loadTestData?viewName="+this.controller().view().name+"&appName="+Trillo.appName,type:"get"}).done($.proxy(this.dataLoaded,this,a)).fail(function(){a.reject({errorMsg:"Failed to load test data"})}),a.promise()}}(),function(){"use strict";Trillo.ViewType={Tree:"tree",Collection:"collection",Table:"table",Grid:"grid",EditableTable:"editableTable",Selector:"selector",Form:"form",Detail:"detail",Chart:"chart",Custom:"custom",Content:"content",Tab:"tab",Dropdown:"dropdown",Nav:"nav",Default:"default",Toc:"toc",NavTree:"navTree",Menu:"menu",FlexGrid:"flexGrid",Dashboard:"dashboard"},Trillo.ImplClassByViewType={"default":"Trillo.View",tree:"Trillo.TreeView",nav:"Trillo.NavView",collection:"Trillo.CollectionView",table:"Trillo.CollectionView",grid:"Trillo.CollectionView",selector:"Trillo.SelectorView",form:"Trillo.FormView",detail:"Trillo.DetailView",chart:"Trillo.ChartView",tab:"Trillo.TabView",dropdown:"Trillo.DropdownView",editableTable:"Trillo.EditableTableView",toc:"Trillo.TocView",content:"Trillo.ContentView",navTree:"Trillo.NavTreeView"},Trillo.SupportsTestDataByViewType={tree:"Trillo.TreeView",collection:"Trillo.CollectionView",table:"Trillo.CollectionView",grid:"Trillo.CollectionView",form:"Trillo.FormView",detail:"Trillo.DetailView",chart:"Trillo.ChartView",editableTable:"Trillo.EditableTableView"},Trillo.isValidViewType=function(a){for(var b in Trillo.ViewType)if(a===Trillo.ViewType[b])return!0;return!1},Trillo.isCollectionView=function(a){return a===Trillo.ViewType.Collection||a===Trillo.ViewType.Table||a===Trillo.ViewType.Grid},Trillo.isTreeView=function(a){return a===Trillo.ViewType.Tree},Trillo.isDetailView=function(a){return a===Trillo.ViewType.Detail},Trillo.isFormView=function(a){return a===Trillo.ViewType.Form},Trillo.isSelectionView=function(a){return a===Trillo.ViewType.Tab||a===Trillo.ViewType.Nav||a===Trillo.ViewType.Selector||a===Trillo.ViewType.Menu},Trillo.getViewTypeByImplClass=function(a){var b=null;return $.each(Trillo.ImplClassByViewType,function(c,d){return d==a?(b=c,!1):void 0}),b},Trillo.supportsTestData=function(a){return Trillo.SupportsTestDataByViewType[a]},Trillo.findAndSelf=function(a,b){var c=a.is(b);return c?a:a.find(b)},Trillo.makePaginationInfo=function(a){a=a||[],"undefined"==typeof a.length&&(a=[a]);var b={};return b.pageSize=a.length,b.numberOfPages=1,b.totalNumberOfItems=b.pageSize,b.pageNumber=1,b},Trillo.convertToArray=function(a){return a=a||[],"undefined"!=typeof a.length?a:[a]},Trillo.chartDataFromModelData=function(a,b){if(!b)return[];if("undefined"!=typeof b.length)return b;var c=b[a];return c&&"undefined"!=typeof c.length?c:[]},Trillo.setFieldValue=function(a,b,c){var d,e,f,g;if(g=a.prop("tagName").toLowerCase(),d=a.dataOrAttr("nm"),e=a.attr("type"),"radio"===e||"checkbox"===e)a.prop("checked",b),c&&a.attr("disabled","true");else if("input"===g||"textarea"===g||"select"===g)"select"===g&&Trillo.setSelectOptionsFromEnum(a,b),a.val(b),a.parent().find(".js-temp-elem-for-readonly").remove(),c?(a.hide(),"select"===g&&(b=a.find("option:selected").text()),a.after('<span class="js-temp-elem-for-readonly">'+b+"</span>")):a.show();else if("img"===g)a.attr("src",b);else if(b=Trillo.formatValue(a,b),f=a.dataOrAttr("display-type"),"css-class"===f)if(b)a.addClass(b),a.attr("_value_as_css_class_",b);else{var h=a.attr("_value_as_css_class_");h&&(a.removeClass(b),a.removeAttr("_value_as_css_class_"))}else a.html("undefined"==typeof b?"":""+b)},Trillo.setReadonlyFieldValue=function(a,b,c){var d=a.prop("tagName").toLowerCase();"img"===d?a.attr("src",b):(b=Trillo.formatValue(a,b),a.html("undefined"==typeof b?"":""+b))},Trillo.resizeAllTextArea=function(a){var b=a.find("textarea");b.length&&autosize.update(b)},Trillo.timeTickFormat={format:function(a){return moment(a).format("M/D H:m")},fit:!0,culling:{max:2}},Trillo.setSelectOptions=function(a,b,c,d,e){var f,g,h="",i=0;d?$.each(b,function(){g=this[d],f=c?this[c]:this.toString(),null===e&&(e=g),h+='<option value="'+g+'">'+f+"</option>"}):$.each(b,function(){f=c?this[c]:this.toString(),null===e&&(e=i),h+='<option value="'+i+'">'+f+"</option>",i++}),a.html(h),a.val(e)},Trillo.setSelectOptionsFromEnum=function(a,b){var c=a.dataOrAttr("enum-name");if(c){var d=Trillo.enumCatalog.getEnum(c);d&&Trillo.setSelectOptions(a,d,"n","v",b)}},Trillo.isCheckxoxOrRadio=function(a){return a.is(":checkbox")||a.is(":radio")},Trillo.isActionElement=function(a){return a.dataOrAttr("nm")&&(a.is(":button")||a.is(":reset")||a.is(":reset")||a.is("a")||a.hasClass("js-tool"))},Trillo.getInputs=function(a){return a.find("input, textarea, select").not(":input[type=button], :input[type=submit], :input[type=reset]")},Trillo.getReadonlyFields=function(a){return a.find(".js-readonly-content","img[nm]")},Trillo.getFieldValue=function(a){switch(a.attr("type")){case"radio":case"checkbox":return a.prop("checked")?!0:!1;default:return a.val()}},Trillo.getClosestNamedElem=function(a){for(;a&&"html"!==(a.prop("nodeName")||"").toLowerCase();){if(a.attr("nm"))return a;a=a.parent()}return null},Trillo.getClosestLabelElem=function(a){for(;a&&"html"!==(a.prop("nodeName")||"").toLowerCase();){if(a.attr("for"))return a;a=a.parent()}return null},Trillo.setDisabled=function(a,b){$.each(a,function(){b?$(this).attr("disabled",!0):$(this).removeAttr("disabled")})},Trillo.getActualTarget=function(a){var b=$(a.target),c=b.prop("tagName").toLowerCase();if(!b.hasClass("js-tool")&&"a"!==c&&"button"!==c){var d=b.find("button");if(0===d.length&&(d=b.find("a")),0===d.length&&(d=b.parent(),c=d.prop("tagName").toLowerCase(),"a"!==c&&"button"!==c))return null;b=d}return b},Trillo.belongsToView=function(a,b){if(0===a.length)return!1;var c=a.dataOrAttr("for-view");return!c||c===b},Trillo.hideCurrentOverlays=function(a,b){a&&Trillo.contextMenuManager.hideCurrentContextMenu(),b&&Trillo.popoverManager.hideCurrentPopup()},Trillo.getViewportWidth=function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},Trillo.getViewportHeight=function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}(),function(){"use strict";Trillo.ViewManager=function(a){this.viewTable={}};var a=Trillo.ViewManager.prototype;a.loadView=function(a){var b=$.Deferred(),c=this.viewTable[a];return c?this.processView(b,c.html):$.ajax({url:Trillo.Config.viewPath+a+Trillo.Config.viewFileExtension,type:"get",datatype:Trillo.appContext.isTrilloServer?"application/json":"text/plain"}).done($.proxy(this.viewLoaded,this,b,a)).fail(function(){b.reject({errorMsg:"Failed to load view file"})}),b.promise()},a.viewLoaded=function(a,b,c){var d,e;if(Trillo.appContext.isTrilloServer){if("failed"===c.status)return Trillo.log.error(c.message||c.status),void a.reject({errorMsg:c.message||c.status,viewName:b});d=c.message||""}else d=c;e=this.viewTable[b]={html:d},this.processView(a,e.html)},a.processView=function(a,b){var c=$("<div></div>");c.html(b);var d=Trillo.getSpecObject(c,"script[spec='view']"),e=Trillo.getSpecObject(c,"script[spec='chart']");e&&(Trillo.isArray(e)||(e=[e]),d.chartSpecs=e);var f=$(c.children()[0]);f.detach(),a.resolve({$e:f,viewSpec:d})}}(),function(){"use strict";Trillo.Builder=function(a){this.options=a};var a=Trillo.Builder.prototype;a._getApp$Elem=function(a){var b=$(".js-application");if(a&&a.length>0){var c=$("[app-container-for='"+a[0].name+"']");if(0===c.length&&(c=$("[data-app-container-for='"+a[0].name+"']")),c.length>0)return c.removeClass("hide"),b.addClass("hide"),c}return b.length>0?b:$("body")},a.buildAppView=function(a){var b=$("body"),c=this._getApp$Elem(Trillo.getRouteSpecsFromRoute(a)),d=this.udpdateViewSpecs(b,null,b.html().indexOf("{{")>0);d?(Trillo.appName&&""!==Trillo.appName||(Trillo.appName=d.name,Trillo.appNamespace||(Trillo.appNamespace=window[Trillo.appName])),Trillo.pageName&&""!==Trillo.pageName||(this.pageName=this.appName)):d={},d=$.extend({},d),d.isAppView=!0;var e=Trillo.getAppParams(a);d.params=$.extend(d.params,e),d.modelSpec||(d.modelSpec={}),d.modelSpec.data=Trillo.appContext;var f=$.Deferred(),g=this;if(d){var h=this.initMvc(c,d);h.done(function(a){a.postSetup(),g.processEmbeddedViews([a],f)}),h.fail(function(a){f.reject(a)})}else f.reject();return f.promise()},a.build=function(a,b){var c=Trillo.getRouteSpecsFromRoute(a),d=$.Deferred();return b.routingToNextView(c,0),this._build(0,c,b,d,[],""),d.promise()},a._build=function(a,b,c,d,e){if(a>=b.length)return void d.resolve(e);var f=c?c.nextView():null,g=b[a];f&&f.name!==Trillo.getViewNameFromPath(g.name)&&(f.markForClearing(),f=null);var h;f?(f.internalRoute="",h=f.viewSpec):(h=c.viewSpec.getNextViewSpecByPath(g.name),h||(h=$.extend({},Trillo.ViewSpecFuncs),h.initFromPath(g.name))),h.params=g.params;var i=this.init(h,f,c),j=this;i.done(function(c){f=c;var g,h,i,k=Trillo.getRouteUptoIndex(b,a-1,!1),l=Trillo.getSubrouteAsStr(b[a],!1),m=Trillo.getQueryStr(b[a]);Trillo.navHistory.add(k,l,m),e.push(c),c.postSetup();var n=c.doInternalRouting(b,a+1);if(n>0){var o=a+n;o>b.length?a=b.length:(a=o,l=b[a].name,k=b[a-1].name)}a+1<b.length&&c.viewSpec.type===Trillo.ViewType.Tree&&(g=c.getNextViewName(),g&&b[a+1].name!==g&&(b.length=a+1)),a+1!==b.length||Trillo.isPreview||(g=c.getNextViewName(Trillo.getFullPath(k,l)),g&&b.push({name:g,params:{}})),a+1<b.length?($.isEmptyObject(b[a+1].params)&&(i=Trillo.getSubrouteAsStr(b[a+1],!1),h=Trillo.navHistory.getParams(Trillo.getFullPath(k,l),i),h&&(b[a+1].params=Trillo.queryStrToParams(g+"?"+h))),c.routingToNextView(b,a+1),j._build(a+1,b,f,d,e)):(f.nextView()&&f.nextView().markForClearing(),j.processEmbeddedViews(e,d))}),i.fail(function(a){d.reject(a)})},a.processEmbeddedViews=function(a,b){for(var c,d,e=a,f=[],g=0,h=e.length;h>g;g++)if(c=e[g],d=c.viewSpec.embeddedSpecs,d&&d.length)for(var i=0;i<d.length;i++)f.push({parentView:c,viewSpec:d[i]});this.buildEmbeddedViews(f,0,a,b).done(function(){b.resolve(a)})},a.buildEmbeddedViews=function(a,b,c,d){var e=$.Deferred();if(b>=a.length)return e.resolve(),e.promise();var f=a[b],g=f.viewSpec;g.prevView=f.parentView;var h=this.init(g,g.view,f.parentView),i=this;return h.done(function(f){f.postSetup();var g=f.viewSpec.embeddedSpecs;if(g&&g.length)for(var j=0;j<g.length;j++)a.push({parentView:f,viewSpec:g[j]});h=i.buildEmbeddedViews(a,b+1,c,d),h.done(function(){e.resolve()})}),h.fail(function(a){d.reject(a)}),e.promise()},a.init=function(a,b,c){a.getMyPath||$.extend(a,Trillo.ViewSpecFuncs);var d,e;if(!b)if(a.viewHtml)e=$("<div></div>"),e.html(a.viewHtml),d=$(e.children()[0]),d.detach(),b=this.createView(d,a,c);else if(a.elementSelector)d=c?$(a.elementSelector,c.$elem()):$(a.elementSelector),b=this.createView(d,a,c);else{if(!a.embedded&&!a.autoLoad)return this.loadTemplateThenInit(a,c);var f='[nm="'+a.name+'"]';if(d=c?$(f,c.$elem()):$(f),!d.length)return this.loadTemplateThenInit(a,c);b=this.createView(d,a,c)}return this.initM(b)},a.loadTemplateThenInit=function(a,b){var c=$.Deferred(),d=this,e=Trillo.viewManager.loadView(a.getViewFileName());return e.done(function(e){var f=e.$e,g=d._udpdateViewSpecs(e.viewSpec,a);g&&(a=$.extend({},g,a));var h=d.initMvc(f,a,b);h.done(function(a){c.resolve(a)}),h.fail(function(a){c.reject(a)})}),e.fail(function(a){c.reject(a)}),c.promise()},a.initMvc=function(a,b,c){var d=this.createView(a,b,c);return this.initM(d)},a.createView=function(a,b,c){b.params=b.params||{};var d=this.createController(b,c);d.customizeViewSpec(b);var e=b.impl||Trillo.ImplClassByViewType[b.type];e||(e="Trillo.View"),debug.debug("Creating view: "+b.name+", "+e);var f=Trillo.getRefByQualifiedName(e);f||(Trillo.log.error("Could not find impl class = "+e+", type = "+b.type+", defaulting to Trillo.View class"),f=Trillo.View),b.type=b.type||Trillo.getViewTypeByImplClass(e),b.prevView=c;var g=new f(a,d,b);return b.view=g,g},a.modelReloadRequired=function(a,b){return b?b.indexOf(a)>=0:!0},a.refresh=function(a,b){var c,d=this,e=$.Deferred();return c=this.modelReloadRequired(a.name,b)?this.initM(a,!0):a.repeatShowUsingModel(),c.done(function(){a.nextView()?d.refresh(a.nextView(),b).done(function(){d.refreshEmbeddedViews(a,e,0,b)}):d.refreshEmbeddedViews(a,e,0,b)}),e.promise()},a.refreshEmbeddedViews=function(a,b,c,d){var e=a.embeddedViews(),f=this;c<e.length?this.refresh(e[c],d).done(function(){f.refreshEmbeddedViews(a,b,c+1,d)}):b.resolve(a)},a.initM=function(a,b){return a.viewSpec.modelSpec=a.viewSpec.modelSpec||{},a.show(b)},a.createController=function(a,b){var c=this.createControllerForName(a),d=Trillo.appNamespace;return c||(c=this.createControllerForNS(d,a),c||(c=this.createControllerForNS(window.Shared,a)),c||(a.controller&&debug.warn("Controller class '"+a.controller+"' not found, using default controller."),c=new Trillo.Controller(a))),a.bizDelegate&&(this.setBizDelegateForNS(d,a,c)||this.setBizDelegateForNS(window.Shared,a,c)),b&&c.setParentController(b.controller()),c},a.createControllerForName=function(a){var b=a.controller;if(b){var c=Trillo.getRefByQualifiedName(b);if(c)return new c(a)}return null},a.createControllerForNS=function(a,b){var c=b.controller||b.name+"C";if(a&&a[c])return new a[c](b);var d=Trillo.getRefByQualifiedName(c);return d?new d(b):null},a.setBizDelegateForNS=function(a,b,c){return a&&a[b.bizDelegate]?(c.setBizDelegate(new a[b.bizDelegate]({controller:c})),!0):!1},a.udpdateViewSpecs=function(a,b){var c=Trillo.getSpecObject(a,"script[spec='view']");return this._udpdateViewSpecs(c,b)},a._udpdateViewSpecs=function(a,b){if(!a)return null;var c=[];a.trigger=a.trigger||a.name,a.getMyPath||$.extend(a,Trillo.ViewSpecFuncs);var d=a.nextViewSpecs;if(d&&$.each(d,function(a,b){$.extend(b,Trillo.ViewSpecFuncs),(b.embedded||b.autoLoad)&&c.push(b)}),c.length){var e=this;$.each(c,function(b,c){a.nextView===c.name&&(a.nextView=null),Trillo.deleteFromArray(d,c),e._udpdateViewSpecs(c,a)}),a.embeddedSpecs=c}return a},Trillo.ViewSpecFuncs={initFromPath:function(a){var b=a.indexOf(":");b>=0?(this.trigger=a.substring(0,b),this.name=a.substring(b+1)):this.name=a},getMyPath:function(){return(this.trigger&&this.trigger!==this.name?this.trigger+":":"")+this.name},getTrigger:function(){return this.trigger?this.trigger:this.name},getNextPath:function(a){if(!a||a.indexOf(":")>=0)return a;var b=this.nextViewSpecs,c=a;return b&&$.each(b,function(b,d){return d.getTrigger()===a?(c=d.getMyPath(),!1):void 0}),c},getDefaultNextPath:function(){return this.nextView?this.getNextPath(this.nextView):null},getViewFileName:function(){return this.viewFileName||this.name},getViewSpecByParentPath:function(a){if(!a)return null;var b=this.nextViewSpecs,c=null;return b&&$.each(b,function(b,d){return d.parentPath===a?(c=d,!1):void 0}),c},getNextViewSpecByPath:function(a){return this.getNextViewSpecByTrigger(Trillo.getTriggerFromPath(a))},getNextViewSpecByTrigger:function(a){var b=this._getNextViewSpecByTrigger(this.nextViewSpecs,a);return b||(b=this._getNextViewSpecByTrigger(this.embeddedSpecs,a)),b},_getNextViewSpecByTrigger:function(a,b){if(!a)return null;var c,d=null,e=this;return $.each(a,function(a,f){return c=f.trigger||f.name,c===b?(d=f,!1):(f.embedded||f.autoLoad)&&(d=e._getNextViewSpecByTrigger(f.nextViewSpecs,b),d||(d=e._getNextViewSpecByTrigger(f.embeddedSpecs,b)),d)?!1:void 0}),d},setParam:function(a,b){this.params[a]=b},getParam:function(a){return this.params[a]},getParams:function(){return this.params}},Trillo.getRouteSpecsFromRoute=function(a){var b=[];if(!a||0===a.length)return b;for(var c,d,e=a.split("/"),f=0;f<e.length;f++)c=e[f],d={name:Trillo.getRouteName(c),params:Trillo.getRouteParams(c)},d.name&&b.push(d);return b},Trillo.getRouteName=function(a){var b=a.indexOf(";");return b>=0?$.trim(a.substring(0,b)):a},Trillo.getAppParams=function(a){var b=a.indexOf(";");if(0===b){var c=a.split("/");return Trillo.getRouteParams("a"+c[0])}return{}},Trillo.getRouteParams=function(a){var b=a.indexOf(";");return b>=0&&(a=a.substring(0,b)+"?"+a.substring(b+1)),Trillo.queryStrToParams(a)},Trillo.queryStrToParams=function(a){return a?(a=a.replace(/;/g,"&"),$.url(a).param()):{}},Trillo.getSubrouteAsStr=function(a,b){var c=a.name;if(0===c.length)return"";if(b){var d=Trillo.getQueryStr(a);c+=d.length?";"+d:""}return c},Trillo.getQueryStr=function(a){var b="";return a.params&&$.each(a.params,function(a,c){0!==a.indexOf("__")&&(b=(b.length?";":"")+(a+"="+c))}),b},Trillo.getRouteUptoIndex=function(a,b,c){if(0>b)return"";for(var d="",e=0;b>=e;e++)d+=(e>0?"/":"")+Trillo.getSubrouteAsStr(a[e],c);return d},Trillo.getFullPath=function(a,b){return(a?a+"/":"")+b}}(),function(){"use strict";Trillo.BaseController=function(a){this.viewSpec=a,this.name=a.name,this._view=null,this._model=null,this._parentController=null,this._nextController=null,this._embeddedControllers=[],this._bizDelegate=null,this.viewsInFlight={}};var a=Trillo.BaseController.prototype;a.setView=function(a){this._view=a},a.view=function(){return this._view},a.parentView=function(){return this._view.parentView()},a.setBizDelegate=function(a){this._bizDelegate=a},a.bizDelegate=function(){return this._bizDelegate},a.model=function(){return this._model},a.apiAdapter=function(){return this._apiAdapter},a.getData=function(){return this._model.data},a.parentModel=function(){return this._parentController?this._parentController.model():null},a.getParentData=function(){return this._parentController?this._parentController.getData():null},a.setParentController=function(a){this._parentController=a},a.parentController=function(){return this._parentController},a.setNextController=function(a){this._nextController=a},a.addEmbeddedController=function(a){this._embeddedControllers.push(a)},a.removeEmbeddedController=function(a){this._embeddedControllers.splice(this._embeddedControllers.indexOf(a),1)},a.clear=function(){},a.createModel=function(){var a=this.viewSpec.modelSpec,b=this.viewSpec.apiSpec;debug.debug("BaseController.createModel() - creating new model for: "+this.viewSpec.name),this._model&&this._model.clear(),this._model=Trillo.modelFactory.createModel(a,this);var c=this.fetchDataLocally(a);if(!c){if(b)return this._apiAdapter=Trillo.apiAdapterFactory.createApiAdapter(b,this),this.loadData();if(!b&&Trillo.supportsTestData(this.viewSpec.type)&&(Trillo.isPreview||Trillo.useTestData))return this._apiAdapter=new Trillo.TestDataAdapter(b,this),this.loadData();c=this.fetchDefaultData(a)}this.dataAvailable(c);var d=$.Deferred();return d.resolve(this._model),d.promise()},a.loadData=function(a){var b=this,c=$.Deferred(),d=this._apiAdapter.loadData();return d.done(function(a,d,e){b.dataAvailable(a,d,e),c.resolve(b._model)}),d.fail(function(a){c.reject(a)}),c.promise()},a.shouldLoadNewData=function(){if(!this.model())return!0;if(this.apiAdapter())return this.apiAdapter().isApiSpecChanged(this.viewSpec.apiSpec);var a=this.getData(),b=this.fetchDataLocally(this.viewSpec.modelSpec)||this.fetchDefaultData(this.viewSpec.modelSpec);return a!==b},a.fetchDataLocally=function(a){if(a.data)return a.data;var b=this.getParentSelectedObj();if(b&&"-1"===Trillo.uidToId(b.uid)){var c=this.parentView().viewSpec.type;if(c===Trillo.ViewType.Tree||Trillo.isCollectionView(c))return b}var d=this.getParentSelectedObj()||this.getParentData(),e=null;if(d&&a.dataPath){if(e=Trillo.getObjectValue(d,a.dataPath))return e;if(e=this.fetchDefaultData(a))return Trillo.setObjectValue(d,a.dataPath,e),e}return null},a.fetchDefaultData=function(a){var b=this.viewSpec.type;if(Trillo.isCollectionView(b)||Trillo.isTreeView(b))return[];if(Trillo.isDetailView(b)||Trillo.isFormView(b))return{};var c=this.getParentSelectedObj()||this.getParentData();return c&&!a.dataPath&&this.viewSpec.embedded?c:{}},a.dataAvailable=function(a,b,c){var d=this.model();d&&(b?this.updatePaginatedData(a,c):(d.setDataQuiet(a),this.postProcessModel(this._model)))},a.updatePaginatedData=function(a,b){var c=this.model();!c.data||b?c.setDataQuiet(a.items):c.appendDataQuiet(a.items),a.items=null,c.setPaginationInfo(a),this.postProcessModel(this._model)},a.postProcessModel=function(a){},a.handleClickGeneric=function(a){if(a){var b=a.dataOrAttr("action-func");if(b&&this[b])return this[b](a,this.getSelectedObj(),this),!0}if(this._handleClickGeneric(a.dataOrAttr("nm"),a,this.getSelectedObj(),this))return!0;var c=a.dataOrAttr("nm");if(c&&"_home"!==c&&"_appHome"!==c){var d=a.attr("href");d&&"#"!==d||Trillo.alert.notYetImplemented(c)}return!1},a._handleClickGeneric=function(a,b,c,d){var e=!1;return this._bizDelegate&&this._bizDelegate.handleAction&&this._bizDelegate.handleAction(a,c,b,d)?!0:(this.handleAction(a,c,b,d)?e=!0:this.delegateActionToParent(a,c,b,d)&&(e=!0),e)},a.handleAction=function(a,b,c,d){},a.delegateActionToParent=function(a,b,c,d){return this.parentController()?this.parentController()._handleClickGeneric(a,c,b,d):!1},a.actionDone=function(a){},a.getSelectedObj=function(){return this._view?this._view.getSelectedObj():null},a.getParentSelectedObj=function(){var a=this.parentController();return a?a.getSelectedObj():null},a.getClosestSelectedObj=function(){var a=this.getSelectedObj();if(!a){var b=this.parentController();a=b?b.getClosestSelectedObj():null}return a},a.canSelectionChange=function(a){return!0},a.selectionChanging=function(a){},a.selectedObjChanged=function(a){},a.customizeViewSpec=function(a){return this.parentController()?this.parentController().customizeChildViewSpec(a):void 0},a.customizeChildViewSpec=function(a){},a.routeToSelectedView=function(a){this.updateRoute(a)},a.getSelected$Elem=function(){return this._view.getSelected$Elem()},a.getSelectedItem=function(){return this._view.getSelectedItem()},a.selectedItemChanged=function(a){},a.setParam=function(a,b){this.viewSpec.setParam(a,b),this.updateRoute()},a.getParam=function(a){return this.viewSpec.getParam(a)},a.getParams=function(){return this.viewSpec.getParams()},a.getRouteUpTo=function(a,b){if(!this.viewSpec.isAppView){var c=this.parentController(),d=c?c.getRouteUpTo(a):"",e=c?c.viewSpec.nextView:null;if(!this.viewSpec.embedded&&!this.viewSpec.autoLoad){var f=this.getMySubrouteAsStr(a);b&&f===e||(d=d+(f.length>0&&d.length>1?"/":"")+f)}return d}return Trillo.Config.pagePath},a.getInternalRoute=function(){return""},a.getMySubrouteAsStr=function(a){var b=this.viewSpec;if(!b)return"";var c=b.getMyPath()+this.getInternalRoute();if(0===c.length)return"";if(a){var d="";$.each(b.params,function(a,b){d+=(d.length?";":"")+(a+"="+b)}),c+=d.length?";"+d:""}return c},a.setRoute=function(a){Trillo.router.routeTo(a,!0)},a.selectAndRoute=function(a){},a.updateRoute=function(a){var b=this.getRouteUpTo(!0);a&&(b+=(b.length?"/":"")+a),Trillo.router.routeTo(b,!0)},a.getSelectionUidOrContextUid=function(){var a=this.getParam("sel");if(a&&Trillo.isUid(a)||(a=this.getParam("uid")),!a){var b=this.parentController();a=b?b.getSelectionUidOrContextUid():null}return a},a.getContextUid=function(){var a=this.getParam("uid");if(!a){var b=this.parentController();a=b?b.getSelectionUidOrContextUid():null}return a},a.customizeModelSpec=function(a){},a.showView=function(a){var b=$.Deferred();if(this.viewsInFlight[a.name])return b.reject(),b.promise();this.viewsInFlight[a.name]=a,a.params=a.params||{},a.embedded=!0;var c=this;return Trillo.builder.init(a,null,this._view).done(function(d){d.postSetup(),c.viewsInFlight[a.name]=null,b.resolve(d)}),b.promise()},a.showViewByName=function(a,b,c){var d={name:a,options:c};return b&&(d.modelSpec={data:b}),this.showView(d)},a.preViewShown=function(a){var b=this.parentController();b&&b.preViewShown(a)},a.postViewShown=function(a){var b=this.parentController();b&&b.postViewShown(a)},a.preViewCleanup=function(a){var b=this.parentController();b&&b.preViewCleanup(a)},a.postViewSetup=function(){},a.viewByName=function(a){var b=this.controllerByName(a);return b?b.view():null},a.controllerByName=function(a){var b=this.findControllerByNameNextDir(a);return b?b:this.findControllerByNamePrevDir(a)},a.findControllerByNameNextDir=function(a){if(this.name===a)return this;for(var b=0;b<this._embeddedControllers.length;b++){var c=this._embeddedControllers[b].findControllerByNameNextDir(a);if(c)return c}return this._nextController?this._nextController.findControllerByNameNextDir(a):void 0},a.findControllerByNamePrevDir=function(a){return this.name===a?this:this._parentController?this._parentController.findControllerByNamePrevDir(a):void 0},a.attrChanged=function(a,b,c,d,e){var f=this.parentController();f&&f.attrChanged(a,b,c,d,e)},a.objChanged=function(a){this._view.objChanged(a);var b=this.parentController();b&&b.objChanged(a)},a.objAdded=function(a,b){this._view.objAdded(a,b);var c=this.parentController();c&&c.objAdded(a,b)},a.objDeleted=function(a){this._view.objDeleted(a);var b=this.parentController();b&&b.objDeleted(a)},a.modelDataChanged=function(a){this._view.modelDataChanged(a);var b=this.parentController();b&&b.modelDataChanged(a)},a.refreshAllViews=function(a){},a.refreshViews=function(a){},a.updateTbState=function(a){this._bizDelegate&&this._bizDelegate.updateTbState&&this._bizDelegate.updateTbState(a)},a.setToolVisible=function(a,b){this._view.toolsMgr.setToolVisible(a,b)},a.setToolVisibleBySelector=function(a,b){this._view.toolsMgr.setToolVisibleBySelector(a,b)},a.postToolsActivate=function(){},a.showResult=function(a){"failed"===a.status?Trillo.alert.showError("Error",a.message||a.status):Trillo.alert.show("Success",a.message||a.status)},a.getAppRootElem=function(){return this._parentController?this._parentController.getAppRootElem():this._view.$elem()},a.showNamedMessagesAsError=function(a){},a.updateTitle=function(){},a.changeManagerUpdated=function(a,b){},a.undoing=function(a,b){},a.redoing=function(a,b){},a.undone=function(a,b){},a.redone=function(a,b){},a.undoCompleted=function(){},a.redoCompleted=function(){},a.txStarted=function(){},a.txEnding=function(){},a.txEnded=function(){},a.beforeShowContextMenu=function(){}}(),function(){"use strict";Trillo.Page=function(a){this.options=a,this._view=null,this.resizeTimer=null,window.onresize=function(){},$(window).resize($.proxy(this.windowResized,this));try{$(window).bind("orientationchange",$.proxy(this.windowResized,this))}catch(b){}this._view=null};var a=Trillo.Page.prototype;a.show=function(a){var b=$.Deferred();if(this._view)this.showViewsForRoute(a,b);else{var c=this,d=Trillo.builder.buildAppView(a);if(!d)return b.promise(),b.promise();d.done(function(d){$("body").addClass(Trillo.CSS.appRready),c._view=d[0],c.showViewsForRoute(a,b)}),d.fail(function(a){b.reject(a)})}return b.promise()},a.showViewsForRoute=function(a,b){if(!a||0===a.length){if(Trillo.isPreview)return b.resolve(),void this._view.addContainerMarks();if(a=this.getNextViewName(),!a||0===a.length)return void b.resolve()}var c=Trillo.builder.build(a,this._view);c.done(function(a){a.length>0&&(a[0].postSetup(),b.resolve(a))}),c.fail(function(a){b.reject(a)})},a.getNextViewName=function(){var a=this._view;return a?a.viewSpec.nextView?a.viewSpec.getDefaultNextPath():a.getNextViewName():null},a.windowResized=function(){this.clearResizeTimer(),this._view&&(this.resizeTimer=setTimeout($.proxy(this._windowResized,this),100))},a._windowResized=function(){this.clearResizeTimer(),this._view&&(Trillo.popoverManager.hideCurrentPopup(),this._view.windowResized())},a.clearResizeTimer=function(){this.resizeTimer&&(clearTimeout(this.resizeTimer),this.resizeTimer=null)},a.fileUploadSuccessful=function(a){var b=this._view.controller().viewByName(a.targetViewName);b&&b.controller().fileUploadSuccessful(a)},a.fileUploadFailed=function(a){var b=this._view.controller().viewByName(a.targetViewName);b&&b.controller().fileUploadFailed(a)},a.viewByName=function(a){return this._view?this._view.controller().viewByName(a):null},a.controllerByName=function(a){return this._view?this._view.controller().controllerByName(a):null},a.layoutContainers=function(){this._view&&this._view.layoutContainers()}}(),function(){"use strict";Trillo.ContextMenuManager=function(a){this.options=a,this.$currentContextMenu=null,this.hideM=$.proxy(this.hideCurrentContextMenu,this)};var a=Trillo.ContextMenuManager.prototype;a.showContextMenu=function(a,b,c){a!==this.$currentContextMenu&&this.$currentContextMenu&&this.hideCurrentContextMenu(),this.$currentContextMenu=a,$("body").append(a),a.show();var d=this.getPosition(a,b,c);a.css({left:d.x,top:d.y}),$(document).on("click",this.hideM)},a.hideCurrentContextMenu=function(){this.$currentContextMenu&&(this.$currentContextMenu.hide(),this.$currentContextMenu=null,$(document).off("click",this.hideM))},a.getPosition=function(a,b,c){var d=a.width(),e=a.height(),f=$(window),g=f.width(),h=f.height();c+e-f.scrollTop()>h&&(c-=e);var i=b+d-f.scrollLeft();return i>g&&(b-=i-g),{x:b,y:c}}}(),function(){"use strict";Trillo.CatalogsLoader=function(){};var a=Trillo.CatalogsLoader.prototype;a.loadCatalogs=function(){var a=$.Deferred();return Trillo.appContext.isTrilloServer?$.ajax({url:"/_loadCatalogs?appName="+Trillo.appName,type:"get",datatype:"application/json"}).done($.proxy(this.catalogsLoaded,this,a)).fail(function(){a.reject({errorMsg:"Failed to load catalogs"})}):a.resolve(),a.promise()},a.catalogsLoaded=function(a,b){var c=b.enums;c&&$.each(c,function(a,b){Trillo.enumCatalog.registerAll(b)}),Trillo.appStrs=b.strings,a.resolve()}}(),function(){"use strict";Trillo.BizDelegate=function(a){this._controller=a.controller};var a=Trillo.BizDelegate.prototype;a.controller=function(){return this._controller},a.informActionDone=function(a){this._controller&&this._controller.actionDone&&this._controller.actionDone(a)},a.handleAction=function(a,b,c,d){return!1}}(),function(){"use strict";Trillo.Main=function(){Trillo.hideBusy(),this.setupContextAndConfig();var a=Trillo.appContext.page.appInitClass||"Trillo.AppInitializer",b=Trillo.getRefByQualifiedName(a),c=b?new b:new Trillo.AppInitializer,d=function(){(new Trillo.CatalogsLoader).loadCatalogs().done(function(){Trillo.router.start()})};c.initApp(d)};var a=Trillo.Main.prototype;a.setupContextAndConfig=function(){Trillo.appContext||(Trillo.appContext={user:{},loggedIn:!1}),Trillo.appContext.page||(Trillo.appContext.page={name:"",appInitClass:"Trillo.AppInitializer"}),Trillo.appName=Trillo.appContext.appName,Trillo.orgName=Trillo.appContext.orgName,Trillo.pageName=Trillo.appContext.pageName||Trillo.appContext.appName,Trillo.appNamespace=window[Trillo.appName],Trillo.isPreview=!!$.url(location.href).param("preview"),
Trillo.useTestData=!!Trillo.appContext.page.useTestData,Trillo.Config.basePath||(Trillo.Config.basePath=Trillo.appContext.basePath?"/"+Trillo.appContext.basePath:"/"),Trillo.Config.pagePath||(Trillo.Config.pagePath=Trillo.appContext.pagePath?"/"+Trillo.appContext.pagePath:Trillo.Config.basePath),Trillo.Config.viewPath||(Trillo.Config.viewPath=Trillo.appContext.isTrilloServer?"/_view/"+Trillo.appName+"/":"/"===Trillo.Config.basePath?"/_view/":Trillo.Config.basePath+"/_view/"),Trillo.appContext.isTrilloServer||Trillo.Config.viewFileExtension&&""!==Trillo.Config.viewFileExtension||(Trillo.Config.viewFileExtension=".html"),$(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(a){var b=$(this);$(".js-navbar-toggle:not([data-target='"+b.data("target")+"'])").each(function(){$($(this).data("target")).removeClass("in").addClass("collapse")})})},Trillo.startApp=function(){new Trillo.Main},$(document).ready(function(){Trillo.startApp()})}();